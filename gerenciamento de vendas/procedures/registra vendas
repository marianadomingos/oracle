CREATE OR REPLACE PROCEDURE REGISTRA_VENDAS (
    ID_CLIENTE NUMBER,
    VALOR_TOTAL NUMBER
) IS
    PRAGMA AUTONOMOUS_TRANSACTION;
BEGIN
 
    -- Insere venda na tabela
    INSERT INTO VENDAS (ID_CLIENTE, VALOR_TOTAL) VALUES (ID_CLIENTE, VALOR_TOTAL);

    -- Chama a função para calcular os pontos de fidelidade
    DECLARE
        PONTOS_CALCULADOS NUMBER;
    BEGIN
        PONTOS_CALCULADOS := CALCULAR_PONTOS_FIDELIDADE(ID_CLIENTE, VALOR_TOTAL);
        DBMS_OUTPUT.PUT_LINE('Pontos de fidelidade calculados: ' || PONTOS_CALCULADOS);
    END;

    COMMIT; -- Realiza o commit para confirmar a transação da PROCEDURE REGISTRA_VENDAS
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK; -- Em caso de erro, desfaz as alterações feitas pela PROCEDURE REGISTRA_VENDAS
        RAISE; -- Propaga o erro para a aplicação externa para que ela possa tratar adequadamente
END;